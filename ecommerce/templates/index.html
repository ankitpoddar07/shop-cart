{% extends "base.html" %}
{% block title %}SHOP CART{% endblock title %}
{% block content %}

<h1>Welcome to shop cart <a href="#"><i class="fa-solid fa-cart-shopping"></i></a></h1><br>
<h2>New Year Sale (2025) started ... <br><br> Please enjoy <a href="#"><i class="fa-solid fa-face-smile-beam"></i></a></h2>

{% endblock content %}

{% block body %}

{% load static %}
{% block banner_slider %}
<!------------------  SLIDER  ------------------->

<div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel" data-bs-interval="2000" data-aos="fade-up">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
  </div>
<!--card /slider 01-->
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="{% static 'assets/img/slider1.jpg' %}" class="d-block w-100" alt="Slider 1">
      <div class="carousel-caption d-none d-md-block">
          <div class="row">
<!--card / 01-->
          <div class="col-sm-3">
              <div class="card-image">
                  <img src="{% static 'assets/img/card/card1.jpg' %}" class="card-img-top" alt="...">                                                
                  <div class="card-body">
                      <h6 class="text-dark">TOYS & GAMES</h6>
                  </div>
              </div>
          </div>                   
          <!--card / 02-->
          <div class="col-sm-3">
              <div class="card-image">
                  <img src="{% static 'assets/img/card/card2.jpg' %}" class="card-img-top" alt="...">
                  <div class="card-body">
                      <h6 class="text-dark">LIGHTING SOLUTIONS</h6>
                  </div>
              </div>
          </div>
          
          <!--card / 03-->
          <div class="col-sm-3">
              <div class="card-image">
                  <img src="{% static 'assets/img/card/card3.jpg' %}" class="card-img-top" alt="...">
                  <div class="card-body">
                      <h6 class="text-dark">FIGURINES & VASES</h6>
                  </div>
              </div>
          </div>
          <!--card / 04-->
          <div class="col-sm-3">
              <div class="card-image">
                  <img src="{% static 'assets/img/card/card12.jpg' %}" class="card-img-top" alt="...">
                  <div class="card-body">
                      <h6 class="text-dark">REFRIGERATORS</h6>
                  </div>
              </div>
          </div>
          
          </div>
          
      </div>
    </div>

<!--card /slider 02-->
    <div class="carousel-item">
      <img src="{% static 'assets/img/slider2.jpg' %}" class="d-block w-100" alt="...">
      <div class="carousel-caption d-none d-md-block">

          <!--card / 01-->
          <div class="row">
              <div class="col-sm-3">
                  <div class="card-image">
                      <img src="{% static 'assets/img/card/card4.jpg' %}" class="card-img-top" alt="...">                                                
                      <div class="card-body">
                          <h6 class="text-white">JEWELLERY</h6>
                      </div>
                  </div>
              </div>                   
              <!--card / 02-->
              <div class="col-sm-3">
                  <div class="card-image">
                      <img src="{% static 'assets/img/card/card5.jpg' %}" class="card-img-top" alt="...">
                      <div class="card-body">
                          <h6 class="text-white">FOOTWEAR</h6>
                      </div>
                  </div>
              </div>
              
              <!--card / 03-->
              <div class="col-sm-3">
                  <div class="card-image">
                      <img src="{% static 'assets/img/card/card6.jpg' %}" class="card-img-top" alt="...">
                      <div class="card-body">
                          <h6 class="text-white">WATCHES</h6>
                      </div>
                  </div>
              </div>
              <!--card / 04-->
          <div class="col-sm-3">
              <div class="card-image">
                  <img src="{% static 'assets/img/card/card11.jpg' %}" class="card-img-top" alt="...">
                  <div class="card-body">
                      <h6 class="text-white">EAR-BUD'S</h6>
                  </div>
              </div>
          </div>
          </div>
      </div>
    </div>

<!--card /slider 03-->
    <div class="carousel-item">
      <img src="{% static 'assets/img/slider3.jpg' %}" class="d-block w-100" alt="...">
      <div class="carousel-caption d-none d-md-block">

          <!--card / 01-->
          <div class="row">
              <div class="col-sm-3">
                  <div class="card-image">
                      <img src="{% static 'assets/img/card/card7.jpg' %}" class="card-img-top" alt="...">                                                
                      <div class="card-body">
                          <h6 class="text-dark">FASHIONS</h6>
                      </div>
                  </div>
              </div>                   
              <!--card / 02-->
              <div class="col-sm-3">
                  <div class="card-image">
                      <img src="{% static 'assets/img/card/card8.jpg' %}" class="card-img-top" alt="...">
                      <div class="card-body">
                          <h6 class="text-dark">HOME DECOR</h6>
                      </div>
                  </div>
              </div>
              
              <!--card / 03-->
              <div class="col-sm-3">
                  <div class="card-image">
                      <img src="{% static 'assets/img/card/card9.jpg' %}" class="card-img-top" alt="...">
                      <div class="card-body">
                          <h6 class="text-dark">AIR CONDITIONERS</h6>
                      </div>
                  </div>
              </div>
              <!--card / 04-->
          <div class="col-sm-3">
              <div class="card-image">
                  <img src="{% static 'assets/img/card/card10.jpg' %}" class="card-img-top" alt="...">
                  <div class="card-body">
                      <h6 class="text-dark">HOME STORAGE</h6>
                  </div>
              </div>
          </div>
          </div>
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>
<!------------------  SLIDER END  ------------------->
{% endblock banner_slider %}

<!------- alert message ------------>
{% for message in messages %} 
<div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
<strong>{{ message }}</strong> 
<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endfor %}
<!------- end alert message ------------>

    <!-- Portfolio Section -->
    <section id="portfolio" class="portfolio section">
        <!-- Section Title -->
        <div class="container section-title" data-aos="fade-up">
          <h2>Welcome to Shop Cart</h2>
          <p><span>Check - Out</span> <span class="description-title">Products</span></p>
        </div>
        <!-- End Section Title -->

        {% for product, range, nSlides in allProds %}

        <h3 class="my-3 text-center text-success bg-light ">{{product.0.category}} : Ultimate Brand Sales <a href="#"><i class="fa-brands fa-salesforce"></i></a></h3>

        <div class="container">
          <div class="row" data-aos="fade-up" data-aos-delay="200">
    
            {% for i in product %}

            <div class="col-md-3 mt-3">

              <img src="/media/{{i.image}}" class="card-img-top" alt="not found" height="200px" width="150px" style="border-radius: 10px;"/>
              <div class="card-body">

                <h5 class="card-title mt-2" id="namepr{{i.id}}">{{i.product_name}}</h5>
                <p class="card-text">{{i.desc|slice:"0:53"}}...</p>
                <h6 class="card-title mb-3">Price:<span id="pricepr{{i.id}}">{{i.price}}</span></h6>

                <span id="divpr{{i.id}}" class="divpr">
                  <button id="pr{{i.id}}" class="btn btn-danger cart btn-sm mt-0">AddToCart <i class="fa-solid fa-cart-shopping"></i></button>
                </span>

                <a href="/media/{{i.image}}"><button class="btn btn-dark btn-sm cart">View <i class="fa-solid fa-eye"></i></button></a>

              </div>
            </div>
    
            {% endfor %}
          </div>
        </div>
        {% endfor %}
  
      </section>
      <!-- /Portfolio Section -->

      <!-- Bootstrap Section for make Cart fuctional  using JavaScripts -->
      <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

      <script>

        // JavaScripts for functionalize cart Buttons.....
  
        //find pout the card from local storage
      
        if (localStorage.getItem('cart') == null) {
            var cart = {};
        } else {
            cart = JSON.parse(localStorage.getItem('cart'));
            updateCart(cart);
      
        }
        // add or increment code
      
        // $('.cart').click(function() {
        $('.divpr').on('click', 'button.cart', function() {
            var idstr = this.id.toString();
            console.log(idstr)
      
            if (cart[idstr] != undefined) {
                qty = cart[idstr][0] + 1;
      
            } else {
                qty = 1;
                name = document.getElementById('name' + idstr).innerHTML;
                price = document.getElementById('price' + idstr).innerHTML;
                cart[idstr] = [qty, name, price];
                
            }
            updateCart(cart);
      
            localStorage.setItem('cart', JSON.stringify(cart));
            document.getElementById('cart').innerHTML = Object.keys(cart).length;
            console.log( Object.keys(cart).length)
            document.getElementById("popcart").click();
        });
        // add pop over to cart
      
        $('#popcart').popover();
      
        updatePopover(cart);
        function updatePopover(cart) {
      
            
            console.log('we are  inside update popover');
            
            var popStr = "";
            var popStr = popStr + "<h5> Your cart is empty !  </h5> <div class='mx-2 my-2'>";
            var i = 1;
            for (var item in cart) {
                popStr = popStr + "<b>" + i + "</b>. ";
                popStr = popStr + document.getElementById('name' + item).innerHTML.slice(0, 19) + "..." + "<b>" +cart[item][0] + "</b>"+ "Qty"  + '<br>';
                i = i + 1;
            }
      
            popStr = popStr + "</div> <a href='/checkout'><button class='btn btn-success' id='clearCart'>Checkout</button></a>  <button class='btn btn-dark' onclick='clearCart()' id='clearCart'>ClearCart</button>"
            document.getElementById('popcart').setAttribute('data-content', popStr);
            $('#popcart').popover('show');
            document.getElementById("popcart").click();
        }
      
        function clearCart() {
            cart = JSON.parse(localStorage.getItem('cart'));
            for (var item in cart) {
                document.getElementById('div' + item).innerHTML = '<button id="' + item + '" class="btn btn-danger cart">AddtoCard <i class="fa-solid fa-cart-shopping"></i></button>'
            }
            localStorage.clear();
            cart = {};
            updateCart(cart);
            
           let clear= document.getElementById("popcart").click();
           document.getElementById("popcart").click();
          
        }
      
        function updateCart(cart) {
            var sum = 0;
            for (var item in cart) {
                sum = sum + cart[item][0];
                document.getElementById('div' + item).innerHTML = "<button id='minus" + item + "'class='btn btn-success minus'>-</button> <span id='val" + item + "''>" + cart[item][0] + "</span> <button id='plus" + item + "' class='btn btn-success plus'> + </button>";
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            document.getElementById('cart').innerHTML = sum;
            console.log(cart);
            updatePopover(cart);
            document.getElementById("popcart").click();
        }
      
        //if plus or minus button is clicked change the cart as well as the display value
        $('.divpr').on("click", "button.minus", function() {
      
            a = this.id.slice(7, );
            cart['pr' + a][0] = cart['pr' + a][0] - 1;
            cart['pr' + a][0] = Math.max(0, cart['pr' + a][0]);
            document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
            updateCart(cart);
            
      
        })
      
      
        $('.divpr').on("click", "button.plus", function() {
      
            a = this.id.slice(6, );
            cart['pr' + a][0] = cart['pr' + a][0] + 1;
      
            document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
            updateCart(cart);
            
      
        })
      </script>
  
{% endblock body %}